/*
 * ws2812.h
 * 
 * Модуль для работы со светодиодными чипами WS2812, а также совместимыми с ними (WS2811, PL9823)
 *
 * Author: Погребняк Дмитрий, г. Самара, 2015
 *
 * Помещённый здесь код является свободным. Т.е. допускается его свободное использование для любых целей,
 * включая коммерческие, при условии указания ссылки на автора (Погребняк Дмитрий, http://aterlux.ru/).
 */ 


#ifndef WS2812_H_
#define WS2812_H_

#include <avr/io.h>

#define LED_DATA_DDR DDRD // Регистр направления порта подключения линейки (линеек) светодиодов
#define LED_DATA_PORT PORTD // Регистр данных порта подключения линейки (линеек) светодиодов
#define LED_DATA 0 // Номер пина порта, к которому подключен DIN первой линейки

// Если LED_DATA2 задано, то вывод осуществляется одновремнно на две линейки. Количество чипов в них должно быть одинаковым 
//#define LED_DATA2 1 // Номер пина порта, к которому подключен DIN второй линейки

#define LED_DATA_OUT_FAST // Если определено - вывод со скоростью 10 тактов на бит, иначе 20 тактов на бит

// При работе на частоте 8МГц LED_DATA_OUT_FAST должно быть определено для: WS2812(B/S), PL9823, WS2811 в быстром режиме,
// и не определено для WS2811 в обычном режиме, либо для вышеперечисленных при частоте МК 16МГц

#ifndef __ASSEMBLER__
 
typedef struct {
  uint8_t r, g, b;
} ws2811_rec; 

typedef struct {
  uint8_t g, r, b;
} ws2812_rec; 

typedef ws2811_rec pl9823_rec;

// Инициализирует порт данных
extern void led_data_init(); 

#ifndef LED_DATA2

// Выводит данные из массива data на линейку из led_count светодиодов
// led_count - строго больше нуля, внутри проверка параметров не производится.
extern void led_data_out(void * data, uint16_t led_count); 

#else

// Выводит данные из массивов data1 и data2 одновременно на две линейки из led_count светодиодов каждая
// led_count - строго больше нуля, внутри проверка параметров не производится.
// data1 и data2 могут быть равны, или указывать на пересекающиеся области
extern void led_data_out2(void * data1, void * data2, uint16_t led_count);

#endif

#endif

#endif /* WS2812_H_ */